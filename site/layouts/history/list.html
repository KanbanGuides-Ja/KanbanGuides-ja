{{- define "main" }}
  {{- $guidePage := .Site.GetPage (printf "/%s/guide" .Site.Language.Lang) | default (.Site.GetPage "/guide") }}
  <section class="container my-5">
    <div class="row mb-4">
      <div class="col-12">
        <h1 class="display-4 text-center mb-3">{{ .Title | default (i18n "history_page_title") }}</h1>
        {{ with .Content }}
          <div class="lead text-center mb-5">{{ . }}</div>
        {{ end }}


        <!-- Evolution explanation -->
        <div class="alert alert-info mx-auto" style="max-width: 800px;" role="alert">
          <div class="d-flex align-items-center">
            <i class="fas fa-info-circle me-3 text-primary" style="font-size: 1.5rem;"></i>
            <div>
              <strong>{{ i18n "history_evolution_title" }}</strong><br />
              {{ i18n "history_evolution_description" (dict "GuideLink" $guidePage.Permalink) | safeHTML }}
            </div>
          </div>
        </div>

        <!-- Visual Fork Summary -->
        <div class="row mt-4 mb-3">
          <div class="col-md-8 mx-auto">
            <div class="card border-primary bg-light">
              <div class="card-body text-center py-3">
                <div class="d-flex justify-content-center align-items-center flex-wrap gap-3">
                  <div class="d-flex align-items-center">
                    <span class="badge bg-secondary me-2">{{ i18n "history_fork_summary_historical" }}</span>
                    <i class="fas fa-arrow-right text-primary mx-2"></i>
                    <i class="fas fa-code-branch text-primary mx-2" style="font-size: 1.2rem;"></i>
                    <i class="fas fa-arrow-right text-primary mx-2"></i>
                    <span class="badge bg-primary">{{ i18n "history_fork_summary_current" }}</span>
                  </div>
                </div>
                <small class="text-muted d-block mt-2">{{ i18n "history_fork_summary_description" }}</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row version-timeline">
      {{- /* Merge version pages from all languages */ -}}
      {{- $versionPages := .Pages }}
      {{- range .Site.Home.Translations }}
        {{- $langHistoryPage := .Site.GetPage (printf "/%s/history" .Language.Lang) | default (.Site.GetPage "/history") }}
        {{- if $langHistoryPage }}
          {{- $versionPages = $versionPages | lang.Merge $langHistoryPage.Pages }}
        {{- end }}
      {{- end }}


      <!-- Latest version - Current Open Guide to Kanban -->
      {{ with $guidePage }}
        <div class="version-latest">
          {{ partial "components/versions/version-card.html" (dict "page" . "isLatest" true) }}
        </div>
      {{ end }}


      <!-- Fork indicator -->
      {{ if gt (len $versionPages) 0 }}
        <div class="version-fork-indicator">
          <div class="fork-text">
            <i class="fas fa-code-branch me-2"></i>
            {{ i18n "history_fork_indicator" }}
          </div>
        </div>
      {{ end }}


      <!-- Historical versions -->
      {{ range ($versionPages.ByDate.Reverse) }}
        <div class="version-historical">
          {{ partial "components/versions/version-card.html" (dict "page" . "isLatest" false) }}
        </div>
      {{ else }}
        {{ if not $guidePage }}
          <div class="col-12">
            <div class="text-center">
              <div class="alert alert-info" role="alert">
                <i class="fas fa-info-circle me-2"></i>
                {{ i18n "history_no_versions_available" }}
              </div>
            </div>
          </div>
        {{ end }}
      {{ end }}
    </div>
  </section>
{{- end }}
{{- define "template" }}
  versions/list.html
{{- end }}
